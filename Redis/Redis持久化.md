# Redis持久化

我们知道Redis是内存数据库，也就是我们常说的NOSQL，不了解Redis的可以看这篇。

Redis 是基于内存执行。每秒最高可以达到 10 万次请求。那么基于内存的 Redis 数据再重启之后不久没了吗？这就要出现能在 Redis 重启后能恢复数据的功能。也就是Redis持久化。Redis 的持久化机制有 AOF 日志，RDB 快照，混合持久化。每一个机制有相应的优缺点。



# AOF 日志

AOF （Append-Only file），在 Redis 执行命令的时候将其追加到 AOF 日志中，比如执行一条写命令，然后就会在 AOF 日志中记录该操作。再下一次重启 Redis 时，从磁盘中读取 AOF 日志根据记录的命令用来恢复数据。恢复速度慢，性能较低，但是它的安全性，可靠性高。适用于重要数据的持久化。



# RDB 快照

RDB 快照 （Redis database），RDB 快照就是存储 Redis 某一时刻的数据存储在文件中，类似于拍照，将当前的数据记录下来。再下一次重启 Redis 的时候就可以从快照文件中恢复数据。恢复速度快，性能高，但是它只能恢复到快照的数据。也就是意味着最后一次快照之后的数据都将丢失。适用于大量数据但不重要的持久化。



# 混合持久化

混合持久化是：AOF 日志 + RDB 快照。可以把它比做成拍照 + 视频。在混合持久化的文件的组成是前面是 RDB 格式尾部是 AOF 格式。当在实现快照的时候，此时的主线程还会在执行命令，混合持久化的文件的前部（比例大）会添加 RDB 快照。在尾部（比例小）会添加快照之后的写时操作。这样子混合持久化机制在下一次重启 Redis 恢复数据的时候就保持着性能高的特点，也最大程度的保住了数据的安全性与完整性。



# 总结

AOF 日志：性能慢，安全性和完整性高。适合重要数据的持久化机制。

RDB 快照：性能快，安全性和完整性低。适合大量的数据但不重要的持久化。

混合持久化：性能快也最大程度的保证了数据的安全性与完整性。

三个持久化机制各有优缺点，具体使用哪一种还是要基于真正的项目需要。

